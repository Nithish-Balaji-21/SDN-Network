<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive ECMP Dashboard - Hackathon Submission</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/cytoscape@3.23.0/dist/cytoscape.cjs"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 28px;
            color: #667eea;
            margin: 0;
        }

        .status-badge {
            display: flex;
            gap: 30px;
            font-size: 14px;
        }

        .badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
        }

        .badge.active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2e7d32;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .card h3 {
            color: #764ba2;
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .comparison-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .comparison-card h3 {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .comparison-values {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 10px;
        }

        .value-box {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
        }

        .adaptive {
            background: #e3f2fd;
            color: #1976d2;
            border: 2px solid #1976d2;
        }

        .traditional {
            background: #fff3e0;
            color: #f57c00;
            border: 2px solid #f57c00;
        }

        .vs {
            font-size: 12px;
            color: #999;
            align-self: center;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .topology-container {
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .flow-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .flow-item {
            padding: 8px;
            margin-bottom: 8px;
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            font-size: 13px;
        }

        .flow-item.congested {
            border-left-color: #ff6b6b;
            background: #ffe8e8;
        }

        .flow-item.balanced {
            border-left-color: #51cf66;
            background: #e8f8f0;
        }

        .chart-container {
            position: relative;
            height: 250px;
            margin-bottom: 20px;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            font-size: 13px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-adaptive {
            background: #1976d2;
        }

        .legend-traditional {
            background: #f57c00;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-box .value {
            font-size: 28px;
            font-weight: bold;
        }

        .timestamp {
            font-size: 12px;
            color: #999;
            text-align: right;
            margin-top: 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        button.primary {
            background: #667eea;
            color: white;
        }

        button.primary:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button.secondary {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        button.secondary:hover {
            background: #e0e0e0;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 12px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .comparison-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .winner-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
        }

        .card {
            position: relative;
        }

        .no-data {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Adaptive ECMP Dashboard</h1>
            <div class="status-badge">
                <div class="badge active">
                    <div class="dot"></div>
                    Adaptive ECMP: <span class="metric-value">Running</span>
                </div>
                <div class="badge">
                    <div class="dot"></div>
                    Traditional ECMP: <span class="metric-value">Ready</span>
                </div>
            </div>
        </header>

        <div class="button-group">
            <button class="primary" onclick="startComparison()"> Start Comparison Test</button>
            <button class="secondary" onclick="refreshData()"> Refresh Data</button>
            <button class="secondary" onclick="exportReport()"> Export Report</button>
        </div>

        <!-- Comparison Metrics -->
        <div class="comparison-grid" id="comparisonGrid">
            <div class="comparison-card">
                <h3>Total Throughput (Mbps)</h3>
                <div class="comparison-values">
                    <div class="value-box adaptive" id="throughput-adaptive">0</div>
                    <div class="vs">vs</div>
                    <div class="value-box traditional" id="throughput-traditional">0</div>
                </div>
            </div>

            <div class="comparison-card">
                <h3>Avg Latency (ms)</h3>
                <div class="comparison-values">
                    <div class="value-box adaptive" id="latency-adaptive">0</div>
                    <div class="vs">vs</div>
                    <div class="value-box traditional" id="latency-traditional">0</div>
                </div>
            </div>

            <div class="comparison-card">
                <h3>Packet Loss (%)</h3>
                <div class="comparison-values">
                    <div class="value-box adaptive" id="loss-adaptive">0</div>
                    <div class="vs">vs</div>
                    <div class="value-box traditional" id="loss-traditional">0</div>
                </div>
            </div>

            <div class="comparison-card">
                <h3>Paths Used</h3>
                <div class="comparison-values">
                    <div class="value-box adaptive" id="paths-adaptive">0</div>
                    <div class="vs">vs</div>
                    <div class="value-box traditional" id="paths-traditional">0</div>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="main-grid">
            <div class="card">
                <h2> Throughput Comparison</h2>
                <div class="chart-container">
                    <canvas id="throughputChart"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box legend-adaptive"></div>
                        Adaptive ECMP
                    </div>
                    <div class="legend-item">
                        <div class="legend-box legend-traditional"></div>
                        Traditional ECMP
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>⏱ Latency Comparison</h2>
                <div class="chart-container">
                    <canvas id="latencyChart"></canvas>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box legend-adaptive"></div>
                        Adaptive ECMP
                    </div>
                    <div class="legend-item">
                        <div class="legend-box legend-traditional"></div>
                        Traditional ECMP
                    </div>
                </div>
            </div>
        </div>

        <!-- Flows Detail -->
        <div class="main-grid">
            <div class="card">
                <h2> Adaptive ECMP Flows</h2>
                <div class="flow-list" id="adaptiveFlows">
                    <div class="no-data">Loading flows...</div>
                </div>
            </div>

            <div class="card">
                <h2> Traditional ECMP Flows</h2>
                <div class="flow-list" id="traditionalFlows">
                    <div class="no-data">Loading flows...</div>
                </div>
            </div>
        </div>

        <!-- System Stats -->
        <div class="card full-width">
            <h2> System Statistics</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="label">CPU Usage</div>
                    <div class="value" id="cpu-usage">0%</div>
                </div>
                <div class="stat-box">
                    <div class="label">Memory Usage</div>
                    <div class="value" id="mem-usage">0%</div>
                </div>
                <div class="stat-box">
                    <div class="label">Network I/O</div>
                    <div class="value" id="network-io">0 MB</div>
                </div>
            </div>
            <div class="timestamp" id="timestamp">Last updated: --:--:--</div>
        </div>

        <div class="footer">
            <p> Hackathon Submission - Adaptive ECMP Load Balancing System</p>
            <p>Real-time comparison between Adaptive and Traditional ECMP routing algorithms</p>
        </div>
    </div>

    <script>
        let throughputChart, latencyChart;

        async function fetchMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();
                updateMetrics(data);
            } catch (error) {
                console.error('Error fetching metrics:', error);
            }
        }

        async function fetchComparison() {
            try {
                const response = await fetch('/api/comparison');
                const data = await response.json();
                updateComparison(data);
            } catch (error) {
                console.error('Error fetching comparison:', error);
            }
        }

        function updateMetrics(data) {
            // Update comparison values
            document.getElementById('throughput-adaptive').textContent = 
                (data.adaptive.total_throughput || 0).toFixed(2);
            document.getElementById('throughput-traditional').textContent = 
                (data.traditional.total_throughput || 0).toFixed(2);
            document.getElementById('latency-adaptive').textContent = 
                (data.adaptive.avg_latency || 0).toFixed(2);
            document.getElementById('latency-traditional').textContent = 
                (data.traditional.avg_latency || 0).toFixed(2);
            document.getElementById('loss-adaptive').textContent = 
                (data.adaptive.packet_loss || 0).toFixed(2);
            document.getElementById('loss-traditional').textContent = 
                (data.traditional.packet_loss || 0).toFixed(2);
            document.getElementById('paths-adaptive').textContent = 
                data.adaptive.path_switches || 0;
            document.getElementById('paths-traditional').textContent = 
                data.traditional.path_switches || 0;

            // Update flows
            displayFlows(data.adaptive.flows, 'adaptiveFlows', 'adaptive');
            displayFlows(data.traditional.flows, 'traditionalFlows', 'traditional');

            // Update timestamp
            const date = new Date(data.timestamp);
            document.getElementById('timestamp').textContent = 
                `Last updated: ${date.toLocaleTimeString()}`;
        }

        function displayFlows(flows, elementId, type) {
            const container = document.getElementById(elementId);
            
            if (!flows || flows.length === 0) {
                container.innerHTML = '<div class="no-data">No active flows</div>';
                return;
            }

            container.innerHTML = flows.map(flow => {
                const isBalanced = flow.throughput > 4.0;
                const status = isBalanced ? 'balanced' : 'congested';
                return `
                    <div class="flow-item ${status}">
                        <strong>${flow.src} → ${flow.dst}</strong><br>
                         ${flow.throughput} Mbps | 
                         ${flow.latency} ms | 
                         ${flow.packets} packets
                    </div>
                `;
            }).join('');
        }

        function updateComparison(data) {
            if (!throughputChart) {
                initializeCharts();
            }

            const labels = data.metrics.map(m => m.name);
            const adaptive = data.metrics.map(m => m.adaptive);
            const traditional = data.metrics.map(m => m.traditional);

            throughputChart.data.labels = ['Throughput'];
            throughputChart.data.datasets[0].data = [data.metrics[0].adaptive];
            throughputChart.data.datasets[1].data = [data.metrics[0].traditional];
            throughputChart.update();

            latencyChart.data.labels = ['Latency'];
            latencyChart.data.datasets[0].data = [data.metrics[1].adaptive];
            latencyChart.data.datasets[1].data = [data.metrics[1].traditional];
            latencyChart.update();
        }

        function initializeCharts() {
            const throughputCtx = document.getElementById('throughputChart').getContext('2d');
            const latencyCtx = document.getElementById('latencyChart').getContext('2d');

            throughputChart = new Chart(throughputCtx, {
                type: 'bar',
                data: {
                    labels: ['Throughput (Mbps)'],
                    datasets: [
                        {
                            label: 'Adaptive ECMP',
                            data: [0],
                            backgroundColor: '#1976d2',
                            borderRadius: 6
                        },
                        {
                            label: 'Traditional ECMP',
                            data: [0],
                            backgroundColor: '#f57c00',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: { beginAtZero: true, max: 15 }
                    }
                }
            });

            latencyChart = new Chart(latencyCtx, {
                type: 'bar',
                data: {
                    labels: ['Average Latency (ms)'],
                    datasets: [
                        {
                            label: 'Adaptive ECMP',
                            data: [0],
                            backgroundColor: '#1976d2',
                            borderRadius: 6
                        },
                        {
                            label: 'Traditional ECMP',
                            data: [0],
                            backgroundColor: '#f57c00',
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: { beginAtZero: true, max: 30 }
                    }
                }
            });
        }

        async function fetchSystemStats() {
            try {
                const response = await fetch('/api/system-stats');
                const data = await response.json();
                document.getElementById('cpu-usage').textContent = data.cpu_percent.toFixed(1) + '%';
                document.getElementById('mem-usage').textContent = data.memory_percent.toFixed(1) + '%';
                const totalIO = ((data.network_io.bytes_sent + data.network_io.bytes_recv) / 1024 / 1024).toFixed(2);
                document.getElementById('network-io').textContent = totalIO + ' MB';
            } catch (error) {
                console.error('Error fetching system stats:', error);
            }
        }

        function startComparison() {
            alert(' Comparison test started!\n\nIn your Mininet terminal, run:\nmininet> h1 iperf -c 10.0.0.4 -t 5\nmininet> h2 iperf -c 10.0.0.4 -t 5\n\nWatch the dashboard update in real-time!');
        }

        function refreshData() {
            fetchMetrics();
            fetchComparison();
            fetchSystemStats();
        }

        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                metrics: {
                    adaptive: document.querySelector('#throughput-adaptive')?.textContent,
                    traditional: document.querySelector('#throughput-traditional')?.textContent
                }
            };
            const dataStr = JSON.stringify(report, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ecmp-report.json';
            link.click();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeCharts();
            refreshData();
            setInterval(refreshData, 2000); // Update every 2 seconds
        });
    </script>
</body>
</html>
